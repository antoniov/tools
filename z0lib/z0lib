#! /bin/bash
# -*- coding: utf-8 -*-
if [ -f ./z0librc ]; then
. ./z0librc
  ZDIR=.
elif [ -f ~/z0librc ]; then
. ~/z0librc
  ZDIR=~
else
. /etc/z0librc
  ZDIR=/etc
fi


##############################################################################
#
#    Copyright (C) SHS-AV s.r.l. (<http://ww.zeroincombenze.it>)
#    All Rights Reserved
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU Affero General Public License as
#    published by the Free Software Foundation, either versiofn 3 of the
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU Affero General Public License for more details.
#
#    You should have received a copy of the GNU Affero General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
##############################################################################

__version__=0.1.14
__version__=$(grep "#__version__" $ZDIR/z0librc|head -n1|awk -F\= '{print $2}')

OPTOPTS=(h        i         n            t        V           v)
OPTDEST=(opt_help opt_xtl   opt_dry_run  opt_test opt_version opt_verbose)
OPTACTI=(1        "*>"      "1>"         "*>"     "*>"        1)
OPTDEFL=(1        ""        0            ""       ""          0)
OPTMETA=("help"   "install" "do nothing" "test"   "version"   "verbose")
OPTHELP=("this help"\
 "install z0librc library in (copy in /etc)"\
 "do nothing (dry-run)"\
 "execute regression tests"\
 "show version"\
 "verbose mode")
OPTARGS=(src tgt)

parseoptargs $@

if [ "$opt_version" ]
then
  echo "$__version__"
  exit 0
fi
if [ $opt_help -gt 0 ]
then
  print_help "z0lib"\
  "(C) 2015 by zeroincombenze(R)\nhttp://wiki.zeroincombenze.org/en/Linux/dev\nAuthor: antoniomaria.vigliotti@gmail.com"
  exit 0
fi
if [ "$opt_xtl" ]; then
  if [ $opt_dry_run -eq 0 -a $EUID -eq 0 ]; then
    _install_z0librc
    echo "Library z0librc V$__version__ installed"
  else
    echo "This command must be executed by root"
  fi
elif [ "opt_test" ]; then
  ./tests/all_tests
fi
exit 0
