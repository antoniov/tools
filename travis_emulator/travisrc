#! /bin/bash
# -*- coding: utf-8 -*-
#
# Common file for travis emulator scripts
#__version__=0.1.49

MAKEF=/opt/odoo/dev/Makefile
DIST_CONF=./conf/.local_dist_pkg.conf
XRGI="^(.*\/|)conf\/.*sample$"
XXXX=".pyc .log .bak .out .tmp .conf build/ dist/ conf/ .cover/ .coverage/ .git/ ~"


opts_travis () {
    if [ -n "$opt_conf" -a -f "$opt_conf" ]; then
      TCONF=$opt_conf
    else
      TCONF=$TDIR/.travis.conf
    fi
    if [ -n "$pkg" ]; then
      if [ ${pkg:0:6} == "local/" ]; then
        PKGPATH=${pkg:6}
        repository="local/"
      elif [ ${pkg:0:5} == "odoo/" -o ${pkg:0:5} == "ODOO/" ]; then
        PKGPATH=${pkg:5}
        repository="ODOO/"
      elif [ ${pkg:0:4} == "oca/" -o ${pkg:0:4} == "OCA/" ]; then
        PKGPATH=${pkg:4}
        repository="OCA/"
      else
        PKGPATH=$pkg
        repository="local/"
      fi
      if [ -z "$PKGPATH" ]; then
        PKGPATH=$PWD
      fi
    else
      PKGPATH=$PWD
      repository="local/"
    fi
    PKGPATH=$(set_pkgpath "$PKGPATH")
    pkgname=$(basename $PKGPATH)
    PKGPATH=$(set_pkgpath "$PKGPATH")
    pkgname=$(basename $PKGPATH)
    if [ "$DEV_ENVIRONMENT" == "$THIS" ]; then
      test_mode=1
    fi
    if [ ${test_mode:-0} -gt 0 ]; then
      opt_dry_run=1
    fi
    local x=$(A=${PWD#*/*/}; echo ${A%%/*})
    if [ "$x" == "travis" ]; then
      HOSTENV=travis
    else
      HOSTENV=local
    fi
}

inherits_travis_opts () {
# inherits_travis_opts(opts_enables)
  local opts=
  if [ -z "$1" ]; then
    local e=nv
  else
    local e=$1
  fi
  if [[ $e =~ d ]]; then
    if [ $opt_diff -gt 0 ]; then
      opts="${opts}d"
    fi
  fi
  if [[ $e =~ n ]]; then
    if [ $opt_dry_run -gt 0 ]; then
      opts="${opts}n"
    fi
  fi
  if [[ $e =~ r ]]; then
    if [ $opt_r -gt 0 ]; then
      opts="${opts}r"
    fi
  fi
  if [[ $e =~ u ]]; then
    if [ $opt_uop -gt 0 ]; then
      opts="${opts}u"
    fi
  fi
  if [[ $e =~ v ]]; then
    if [ $opt_verbose -gt 0 ]; then
      opts="${opts}v"
    fi
  fi
  if [[ $e =~ c ]]; then
    if [ -n "$opt_conf" ]; then
     opts="${opts}c$TCONF"
    fi
  fi
  if [ -n "$opts" ]; then
    opts="-${opts}"
  fi
  echo "$opts"
}

init_travis () {
    if [ ${opt_dry_run:-0} -gt 0 ]; then
      opts_dry_run=-n
    else
      opts_dry_run=
    fi
    if [ ${opt_upd:-0} -gt 0 ]; then
      opts_upd=-u
    else
      opts_upd=
    fi
    if [ ${opt_verbose:-0} -eq 0 ]; then
      opt_verbose=$(get_cfg_value "" "loglevel")
    fi
    if [ $opt_verbose -ne 0 ]; then
      opts_verbose=-v
    else
      opts_verbose=
    fi
    ODOO_SETUP=$(get_cfg_value "" "ODOO_SETUP")
    if [ -n "$ODOO_SETUP" -a -f $ODOO_SETUP ]; then
      SETUP="$ODOO_SETUP";
      REPOSNAME=$(basename $(readlink -e ..))
      if [ "$REPOSNAME" == "odoo" -o "$REPOSNAME" == "openerp" ]; then
        REPOSNAME=
      fi
    elif [ -n "$ODOO_SETUP" -a "$(basename $(readlink -e ../))" == "openerp" ]; then
      SETUP="$ODOO_SETUP";
      REPOSNAME=$(basename $(readlink -e ../..))
    elif [ -f $PKGPATH/setup.py ]; then
      SETUP="$PKGPATH/setup.py";
      REPOSNAME=$(basename $PKGPATH)
    else
       SETUP="$ODOO_SETUP";
       REPOSNAME=
    fi
    if [ "$SETUP" == "$ODOO_SETUP" ]; then
      if [ -z "$PRJNAME" ]; then
        PRJNAME="Odoo"
      fi
      if [ -f $SETUP ]; then
        prjversion=$(grep "'version' *:" $SETUP 2>/dev/null|awk -F":" '{print $2}'|tr -d "\"', \r\n")
        prjdesc=$(grep "'name' *:" $SETUP 2>/dev/null|awk -F":" '{print $2}'|tr -d "\"',\r\n")
      else
        prjversion=""
        prjdesc="Unrecognized Odoo module"
      fi
    else
      if [ -n "$SETUP" -a -f $SETUP ]; then
        if [ -z "$PRJNAME" ]; then
          PRJNAME=$(grep "[^a-zA-Z0-9_]name *=" $SETUP 2>/dev/null|awk -F"=" '{print $2}'|tr -d "\"', \r\n")
        fi
        prjversion=$(grep "[^a-zA-Z0-9_]version *=" $SETUP 2>/dev/null|awk -F"=" '{print $2}'|tr -d "\"', \r\n")
        if [ "$prjversion" == "version" ]; then
          prjversion=""
        fi
        prjdesc=$(grep "[^a-zA-Z0-9_]description *=" $SETUP 2>/dev/null|awk -F"=" '{print $2}'|tr -d "\"',\r\n")
        if [ "$prjdesc" == "description" ]; then
          prjdesc="Unrecognized package"
        fi
      fi
    fi
    if [ "$PRJNAME" == "odoo" ]; then
      PRJNAME=Odoo
    fi
    if [ "$PRJNAME" == "Odoo" ]; then
      BRANCH=$(if $(echo "$PWD/"|grep "/v9/\|9.0/">/dev/null); then echo "9.0"; elif $(echo "$PWD/"|grep "/v8/\|8.0/">/dev/null); then echo "8.0"; else echo "7.0"; fi)
      if [ -z "$prjversion" ]; then
        prjversion="$BRANCH"
      else
        local v
        local x=1
        for v in 7.0 8.0 9.0; do
          if [ ${prjversion:0:3} == "$v" -a $prjversion != "$v" ]; then
            x=0
          fi
        done
        if [ $x -gt 0 ]; then
          prjversion="$BRANCH.$prjversion"
        fi
      fi
      if [ -f $ODOO_SETUP ]; then
        PRJPATH=$(readlink -f $PKGPATH/..)
      else
        PRJPATH=$PKGPATH
      fi
    else
      PRJPATH=$PKGPATH/$PRJNAME
    fi

    if [ -z "$TOOLS_PATH" ]; then
      if [ -d $TDIR/_travis -a ${opt_r:-0} -gt 0 ]; then
        TOOLS_PATH=$TDIR/_travis
      elif [ -d $HOME/dev/_travis -a ${opt_r:-0} -gt 0 ]; then
        TOOLS_PATH=$HOME/dev/_travis
      elif [ -d $TDIR/maintainer-quality-tools/travis ]; then
        TOOLS_PATH=$TDIR/maintainer-quality-tools/travis
      elif [ -d $HOME/dev/maintainer-quality-tools/travis ]; then
        TOOLS_PATH=$HOME/dev/maintainer-quality-tools/travis
      elif [ -d /opt/odoo/dev/maintainer-quality-tools/travis ]; then
        TOOLS_PATH=/opt/odoo/dev/maintainer-quality-tools/travis
      else
        unset -v TOOLS_PATH
      fi
    fi
    if [ $opt_verbose -gt 0 ]; then
      echo "TOOLS_PATH=$TOOLS_PATH"
    fi
}

prepare_env_travis () {
    local action="$1"
    if [ $(echo $PATH|grep -v "$TOOLS_PATH"  2>/dev/null) ]; then
      export PATH=$TOOLS_PATH:$PATH
    fi
    export FLAKE8_CONFIG_DIR=$TOOLS_PATH/cfg
    export LINT_CHECK=1
    export BRANCH
    export VERSION=$BRANCH
    export TRAVIS_BUILD_DIR=$PKGPATH
    export VERBOSE_MODE=$opt_verbose
    if [ "$action" == "check" ]; then
      export LINT_CHECK=1
    elif [ "$action" == "test" ]; then
      export LINT_CHECK=0
    elif [ "$PRJNAME" != "Odoo" ]; then
      export LINT_CHECK=1
    else
      unset -v LINT_CHECK
    fi
    repository=$repository$pkgname
    if [ "$PRJNAME" != "Odoo" ]; then
      export ODOO_REPO=$repository
    fi
    if [ -n "$opt_dpath" ]; then
      LGITPATH="$opt_dpath"
    else
      if [ -n "$REPOSNAME" ]; then
        LGITPATH=$(get_cfg_value "" "${REPOSNAME}_distpath")
      else
        LGITPATH=
      fi
      if [ -z "$LGITPATH" ]; then
        LGITPATH=$(get_cfg_value "" "${PRJNAME}_distpath")
      fi
      if [ -z "$LGITPATH" ]; then
        LGITPATH=$(get_cfg_value "" "distpath")
      fi
    fi
    export LGITPATH=$(expand_path "$LGITPATH")
    DEVPATH=$TDIR
}

check_4_travis () {
    if [ ! -d $PKGPATH ]; then
      echo "Invalid package path $PKGPATH"
      exit $STS_FAILED
    elif [ "$PRJNAME" != "Odoo" ]; then
      if [ ! -d $PKGPATH/$pkgname ]; then
        echo "Invalid package path $PKGPATH/$pkgname"
        exit $STS_FAILED
      fi
    fi
}

do_chkconfig () {
    echo "Project name   = \"$PRJNAME\""
    echo "Tools path     = \"$DEVPATH\""
    echo "Hosted         = \"$HOSTENV\""
    echo "Branch         = \"$BRANCH\""
    echo "Package name   = \"$pkgname\""
    echo "Version        = \"$prjversion\""
    echo "Setup file     = \"$SETUP\""
    echo "Project path   = \"$PRJPATH\""
    echo "Package path   = \"$PKGPATH\""
    echo "Local git path = \"$LGITPATH\""
    echo "Config file    = \"$TCONF\""
}

conf_default () {
    set_cfg_def "loglevel" "0"
    set_cfg_def "DEV_HOST" "shsdev16"
    set_cfg_def "PRD_HOST" "shsprd14"
    set_cfg_def "ODOO_SETUP" "__openerp__.py"
}


expand_path () {
# expand_path (path)
# return:path
    echo "$1"|sed -e s:\${pkgpath}:$PKGPATH:g -e s:\${pkgname}:$pkgname:g -e s:\${prjname}:$PRJNAME:g -e s:\${reposname}:$REPOSNAME:g
}


set_pkgpath () {
# set_pkgpath (pkgname)
# return:pkgpath
    PKGPATH="$1"
    if [ -z "$PKGPATH" ]; then
      PKGPATH=$PWD
    fi
    if [ "${PKGPATH:0:1}" != "." -a "${PKGPATH:0:1}" != "/" ]; then
      local x=$(readlink -e ../$PKGPATH)
      if [ "$x" ]; then
        if [ "$(basename $x)" == "$PKGPATH" ]; then
          PKGPATH=$x
        fi
      fi
    else
      PKGPATH=$(readlink -e $PKGPATH)
    fi
    local x="$(readlink -e $PKGPATH/..)"
    if [ "$x" ]; then
      local d=
      for d in tests build dist conf .cover .coverage; do
        if [ "$(basename $PKGPATH)" == "$d" ]; then
          PKGPATH="$x"
          local x="$(readlink -e $PKGPATH/..)"
          break
        fi
      done
    fi
    if [ "$x" ]; then
      if [ "$(basename $x)" == "$(basename $PKGPATH)" -a -f "$x/setup.py" ]; then
        PKGPATH="$x"
      fi
    fi
    echo "$PKGPATH"
}

install_dev () {
    if [ "$USER" == "openerp" -o "$USER" == "odoo" ]; then
      local yod=$(date +%Y)
      if [ ! -d ~/dev ]; then
        mkdir -p ~/dev
      fi
      if [ ! -d ~/dev/pypi ]; then
        mkdir -p ~/dev/pypi
      fi
      if [ ! -d ~/dev/_travis ]; then
        mkdir -p ~/dev/_travis
      fi
      if [ ! -d ~/tools ]; then
        mkdir -p ~/tools
      fi
      if [ ! -d ~/tools/travis_emulator ]; then
        mkdir -p ~/tools/travis_emulator
      fi
      if [ ! -d ~/7.0 ]; then
        mkdir -p ~/7.0
      fi
      if [ ! -d ~/8.0 ]; then
        mkdir -p ~/8.0
      fi
      if [ ! -d ~/7.0/zeroincombenze ]; then
        mkdir -p ~/7.0/zeroincombenze
        touch -d $yod-01-01 ~/7.0/zeroincombenze/__openerp__.py
      fi
      if [ ! -d ~/7.0/zeroincombenze/l10n_it_bbone ]; then
        mkdir -p ~/7.0/zeroincombenze/l10n_it_bbone
        touch -d $yod-01-01 ~/7.0/zeroincombenze/l10n_it_bbone/__openerp__.py
      fi
      if [ ! -d ~/7.0/zeroincombenze/l10n_it_bbone/conf ]; then
        mkdir -p ~/7.0/zeroincombenze/l10n_it_bbone/conf
      fi
      if [ ! -d ~/7.0/zeroincombenze/l10n_it_fiscal ]; then
        mkdir -p ~/7.0/zeroincombenze/l10n_it_fiscal
        touch -d $yod-01-01 ~/7.0/zeroincombenze/__openerp__.py
      fi
      if [ ! -d ~/7.0/zeroincombenze/l10n_it_fiscal/data ]; then
        mkdir -p ~/7.0/zeroincombenze/l10n_it_fiscal/data
      fi
      if [ ! -d ~/7.0/zeroincombenze/l10n_it_fiscal/conf ]; then
        mkdir -p ~/7.0/zeroincombenze/l10n_it_fiscal/conf
      fi
    fi
}


update_dev () {
    XDPATH=$(echo "$(dirname $MAKEF)")
    ME_BOS="test_nightly .test_nightly.conf.sample"
    if [ "$1" == "travis_emulator" ]; then
      RFLIST="autopep8_W503.py beauty dist_pkg please please.man please.py prjdiff topep8 travis .travis.conf travisrc vfcp vfdiff wok_doc wok_doc.py"
      RDLIST="_travis/"
    elif [ "$1" == "z0lib" ]; then
      RFLIST="Makefile z0testrc"
      RDLIST=""
    else
      RFLIST=""
      RDLIST=""
    fi
    xvalid=1
    if [ -n "$RFLIST" ]; then
      for x in $RFLIST; do
        if [ ! -f $PKGPATH/$pkgname/$x ]; then
          xvalid=0
        fi
      done
    fi
    if [ $xvalid -eq 0 ]; then
       echo "Invalid package $1!"
       exit $STS_FAILED
    fi
    if [ -z "$opt_sts" -o "$opt_cpush" != "-w" ]; then
      for x in $RFLIST; do
        if [ -f $PKGPATH/$pkgname/$x ]; then
          if [ ${opt_diff:-0} -gt 0 ]; then
            if [ "$(diff -rq $XLDF $PKGPATH/$pkgname/$x $XDPATH/$x)" ]; then
              if [ ${opt_verbose:-0} -gt 0 ]; then echo "> diff -rq $XLDF $PKGPATH/$pkgname/$x $XDPATH/$x"; fi
              diff -rq $XLDF $PKGPATH/$pkgname/$x $XDPATH/$x
            fi
          elif [ ${opt_fetch:-0} -gt 0 ]; then
            if [ ${opt_verbose:-0} -gt 0 ]; then echo "> $opt_dry_run||cp $XDPATH/$x $PKGPATH/$pkgname/$x"; fi
            (($opt_dry_run))||cp $XDPATH/$x $PKGPATH/$pkgname/$x
          else
            if [ $opt_verbose -gt 0 ]; then echo "> $opt_dry_run||cp $PKGPATH/$pkgname/$x $XDPATH/$x"; fi
            (($opt_dry_run))||cp $PKGPATH/$pkgname/$x $XDPATH/$x
          fi
        fi
      done
      if [ -n "$RDLIST" ]; then
        for x in $RDLIST; do
          if [ ${opt_diff:-0} -gt 0 ]; then
             diff -rq $XLDF $PKGPATH/$pkgname/$x $XDPATH/$x
          elif [ ${opt_fetch:-0} -eq 0 ]; then
             if [ $opt_verbose -gt 0 ]; then echo "> $opt_dry_run||cp -R $PKGPATH/$pkgname/$x $XDPATH/$x"; fi
             (($opt_dry_run))||cp -R $PKGPATH/$pkgname/$x $XDPATH/$x
          fi
        done
      fi
      if [ -n "$ME_BOS" ]; then
        for x in $ME_BOS cronow; do
          if [ -f $PKGPATH/$pkgname/$x ]; then
            if [ ${opt_diff:-0} -gt 0 ]; then
              if [ "$(diff -rq $XLDF $PKGPATH/$pkgname/$x ~/bin/$x)" ]; then
                if [ ${opt_verbose:-0} -gt 0 ]; then echo "> diff -rq $XLDF $PKGPATH/$pkgname/$x ~/bin/$x"; fi
                diff -rq $XLDF $PKGPATH/$pkgname/$x ~/bin/$x
              fi
            elif [ ${opt_fetch:-0} -gt 0 ]; then
              true
            else
              if [ $opt_verbose -gt 0 ]; then echo "> $opt_dry_run||cp $PKGPATH/$pkgname/$x ~/bin/$x"; fi
              (($opt_dry_run))||cp $PKGPATH/$pkgname/$x ~/bin/$x
            fi
          fi
        done
      fi
      # set +x #debug
      MAKEF=$PKGPATH/$pkgname/Makefile
    fi
}

a_append () {
# a_append (key, values)::DEFPRM,DEFVAL
# return:
# key=="--new" && value=="" -> clean dictionary
    if [ "$1" == "--new" -a -z "$2" ]; then
      unset DEFPRM[*]
      unset DEFVAL[*]
      return
    fi
    if [ "$1" ]; then
      local l=${#DEFPRM[*]}
      DEFPRM[l]="$1"
      DEFVAL[l]="$2"
    fi
}


a_search () {
# a_search (key)::DEFPRM,DEFVAL
# return:value,sts
    local jy=0
    local p=""
    local sts=0
    while ((jy<${#DEFPRM[*]})); do
      if [ "${DEFPRM[jy]:0:1}" == "^" ]; then
        if [[ "$1" =~ ${DEFPRM[jy]} ]]; then
          p="${DEFVAL[jy]}"
          sts=1
          break
        fi
      elif [[ "$1" == "${DEFPRM[jy]}" ]]; then
         p="${DEFVAL[jy]}"
         sts=1
         break
      fi
      ((jy++))
    done
    echo "$p"
    return $sts
}


matches1of () {
# matches1of (filename, exclist)
# return:true/false
    local x=
    sts=1
    for x in $2; do
      if [[ "$1" =~ $x ]]; then
        sts=0
        break
      fi
    done
    return $sts
}


robocopy_init () {
# robocopy_init (prjname, pkgname)::DIST_CONF,TCONF,opt_fetch,opt_verbose
# return:
    a_append "--new"
    a_append "^.*\.egg-info$" ""
    if [ "$1" == "Odoo" ]; then
      a_append "^.*" "/"
    else
      a_append "Makefile" "/"
      a_append "setup.py" ""
      a_append "$2" "/"
      a_append "conf" "/"
      if [ ${opt_fetch:-0} -eq 0 ]; then
         a_append "README.rst" "/"
         a_append "README.md" "/"
      fi
      a_append "^.*" ""
    fi
    if [ "$DIST_CONF" ]; then
      local xx=$(grep "^ignore *=" $DIST_CONF 2>/dev/null|awk -F"[a-z0-9 ]=" '{print $2}'|tr -d "\"'\r\n")
      local yy=$(grep "^ignorediff *=" $DIST_CONF 2>/dev/null|awk -F"[a-z0-9 ]=" '{print $2}'|tr -d "\"'\r\n")
    fi
    if [ -z "$xx" -a "$TCONF" ]; then
      local xx=$(grep "^ignore *=" $TCONF 2>/dev/null|awk -F"[a-z0-9 ]=" '{print $2}'|tr -d "\"'\r\n")
      local yy=$(grep "^ignorediff *=" $TCONF 2>/dev/null|awk -F"[a-z0-9 ]=" '{print $2}'|tr -d "\"'\r\n")
    fi
    if [ -z "$xx" ]; then
      # TODO: addons
      local xx=".pyc .log .bak .out .conf build/ dist/ conf/ filestore/ .cover/ .coverage/ .git/ ~"
      local yy=".po .pot"
    fi
    XRGX=
    XLFS=
    XLDF=
    for x in $xx; do
      local x1="${x:0:1}"
      local l=
      let l=${#x}-1
      local x9="${x:l:1}"
      if [ "$x9" == "/" ]; then
         XRGX="$XRGX ^(.*\\/|)$x"
         XLFS="$XLFS --exclude=$x"
      elif [ "$x1" == "." -o "$x" == "~" ]; then
         XRGX="$XRGX ^.*\\$x\$"
         XLFS="$XLFS --exclude=*$x"
      else
         XRGX="$XRGX $x"
         XLFS="$XLFS --exclude=*$x*"
      fi
      XLDF="$XLDF -x '*$x'"
    done
    XXDF=
    for x in $yy; do
      local x1="${x:0:1}"
      local l=
      let l=${#x}-1
      local x9="${x:l:1}"
      if [ "$x9" == "/" ]; then
         XXDF="$XXDF ^(.*\\/|)$x"
      elif [ "$x1" == "." -o "$x" == "~" ]; then
         XXDF="$XXDF ^.*\\$x\$"
      else
         XXDF="$XXDF $x"
      fi
    done
}


robocopy () {
# robocopy (srcfname, tgtpath, sshopt)::opt_dry_run,opts_dry_run,opt_verbose,XRGX,XRGI,XLFS
# return:
    if [ -d "$1" ]; then
      local t="d"
      local ff=$1/
    else
      local t="f"
      local ff=$1
    fi
    local fn=$(basename $1)
    if $(matches1of "$ff" "$XRGI"); then
      local v=$(a_search "$fn")
    elif $(matches1of "$ff" "$XRGX"); then
      local v=
    else
      local v=$(a_search "$fn")
    fi
    if [ "${v:0:1}" == "/" ]; then
      if [ "$v" == "/" -a "$t" == "d" ]; then
        if [ "${3:0:3}" == "ssh" ]; then
          if [ ${opt_verbose:-0} -gt 0 ]; then
            local optrsync="-abvzhe"
          else
            local optrsync="-abzhe"
          fi
          local optssh="$3"
          echo "rsync $opts_dry_run $optrsync \"$optssh\" $opts_upd --del --copy-links $XLFS $ff $2$v"
          rsync $opts_dry_run $optrsync "$optssh" $opts_upd --del --copy-links $XLFS $ff $2$v
        else
          if [ ${opt_verbose:-0} -gt 0 ]; then
            local optrsync="-abv"
          else
            local optrsync="-ab"
          fi
          local optssh=""
          echo "rsync $opts_dry_run $optrsync $opts_upd --del --copy-links $XLFS $ff $2$v"
          rsync $opts_dry_run $optrsync $opts_upd --del --copy-links $XLFS $ff $2$v
        fi
      else
        if [ "${3:0:3}" == "ssh" ]; then
          local optssh="${3:3}"
          echo "(($opt_dry_run))||scp -Bp $optssh $ff $2"
          (($opt_dry_run))||scp -Bp $optssh $ff $2
        else
          if [ ! -d "$2" ]; then
            local v=
          fi
          diff -q $ff $2$v &>/dev/null
          if [ $? -ne 0 ]; then
            echo "$opt_dry_run||cp -L $ff $2$v"
            (($opt_dry_run))||cp -L $ff $2$v
          fi
        fi
      fi
    fi
}

clean_dirs () {
# clean_dirs (directory)::
# return:
    for x in $XXXX;do
      if [ "$x" != ".conf" ]; then
        if [ $opt_dry_run -gt 0 ]; then
          find $1 -nowarn -name "*$x" -exec echo "1||rm '{}'" \;
        else
          find $1 -nowarn -name "*$x" -exec rm -f '{}' \;
        fi
      fi
    done
}


do_summary () {
    echo "+======================================="
    echo "|  Tests summary:"
    echo "|---------------------------------------"
    if [ $3 -eq $STS_SUCCESS ]; then
      echo "| test_bash                   Success"
    else
      echo "| test_bash                   FAIL"
    fi
    if [ $1 -eq $STS_SUCCESS ]; then
      echo "| test_flake8                 Success"
    else
      echo "| test_flake8                 FAIL"
    fi
    if [ $2 -eq $STS_SUCCESS ]; then
      echo "| test_pylint                 Success"
    else
      echo "| test_pylint                 FAIL"
    fi
    echo "+======================================="
}
